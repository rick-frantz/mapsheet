<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4/leaflet.css" />
	 <!--[if lte IE 8]>
	     <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4/leaflet.ie.css" />
	 <![endif]-->
	</head>
  <body>

    <div id="map" style="height: 800px; width: 600px"></div>

    <script type="text/javascript" src="common/tabletop.js"></script>
    <script type="text/javascript" src="common/handlebars.js"></script>
    <!--<script src="http://cdn.leafletjs.com/leaflet-0.4.5/leaflet.js"></script>-->
    <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>

    <script type="text/javascript" src="../src/mapsheet.js"></script>

    <script id="popup-template" type="text/x-handlebars-template">
			<h3><a href='{{link}}' target='_blank'>{{name}}</a></h3>
			<p>{{borough}}</p>
			<p>{{streetaddress}}</p>
			<p>{{type}}</p>
			<p><a href='{{link}}' target='_blank'>{{link}}</a></p>
    </script>

    <script type="text/javascript">
    	window.onload = function() { init() };

      var public_spreadsheet_url = 'https://docs.google.com/spreadsheet/pub?key=0AtG9_k99Q_n6dFJsV3drNldsRnZxN1dLX1ljbDVDZHc&output=html';
			
      var map = L.map('map').setView([51.505, -0.09], 13);
      
      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoicmZyYW50eiIsImEiOiJkN2p1Wm93In0.uha-WxArw2jdGYmsvacXeA', {
			maxZoom: 18,
			attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
				'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
				'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
			id: 'mapbox.streets'
		}).addTo(map);
      
      function init() {
        Mapsheet( { key: public_spreadsheet_url,
		element: "map",
		popupTemplate: "popup-template",
		provider: Mapsheet.Providers.Leaflet,
		markerOptions: {
			iconSize:   [32, 37], 
			iconAnchor:   [16, 37]
				}
	});
      }

      document.write("The published spreadsheet is whack and located at <a target='_new' href='" + public_spreadsheet_url + "'>" + public_spreadsheet_url + "</a>");        
    </script>
  </body>
</html>
